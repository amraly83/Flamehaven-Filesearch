{
  "version": "1.1.0",
  "baseline_date": "2025-11-13",
  "description": "Golden baseline for FLAMEHAVEN FileSearch v1.1.0 - Reference state for drift detection",
  "purpose": "This baseline captures the expected state of the system after Phase 1 and Phase 2 completion. Use it to detect configuration drift, dependency changes, and security regressions during v1.1.x development.",

  "dependencies": {
    "core": {
      "pydantic": ">=2.0.0",
      "google-genai": ">=0.2.0"
    },
    "api": {
      "fastapi": ">=0.121.1",
      "uvicorn": ">=0.24.0",
      "python-multipart": ">=0.0.6",
      "httpx": ">=0.24.1",
      "requests": ">=2.31.0"
    },
    "security": {
      "bandit": ">=1.7.0",
      "safety": ">=3.0.0"
    },
    "notes": "FastAPI 0.121.1+ required for starlette 0.49.3+ (CVE-2024-47874, CVE-2025-54121 fixes)"
  },

  "security_posture": {
    "vulnerabilities": {
      "critical": 0,
      "high": 0,
      "medium": 1,
      "low": 0,
      "notes": "1 medium: B104 hardcoded_bind_all_interfaces (intentional for deployment)"
    },
    "path_traversal_protection": {
      "implemented": true,
      "method": "os.path.basename() sanitization",
      "locations": ["api.py:165-170", "api.py:218-223"],
      "test_coverage": "tests/test_security.py"
    },
    "secrets_scanning": {
      "gitleaks": "enabled",
      "trufflehog": "enabled",
      "custom_patterns": "enabled"
    },
    "sast": {
      "bandit": "enabled",
      "codeql": "enabled"
    },
    "dependency_scanning": {
      "safety": "enabled",
      "trivy": "enabled"
    }
  },

  "api_endpoints": {
    "/health": {
      "method": "GET",
      "authentication": "none",
      "expected_response_time_ms": 100
    },
    "/metrics": {
      "method": "GET",
      "authentication": "none",
      "expected_response_time_ms": 500
    },
    "/api/upload/single": {
      "method": "POST",
      "authentication": "none",
      "max_file_size_mb": 50,
      "security_checks": ["path_traversal", "filename_validation", "hidden_file_rejection"]
    },
    "/api/upload/multiple": {
      "method": "POST",
      "authentication": "none",
      "max_files": 100,
      "security_checks": ["path_traversal", "filename_validation", "hidden_file_rejection"]
    },
    "/api/search": {
      "method": "POST",
      "authentication": "none",
      "max_results": 5,
      "expected_response_time_ms": 3000
    }
  },

  "configuration": {
    "defaults": {
      "MAX_FILE_SIZE_MB": 50,
      "UPLOAD_TIMEOUT_SEC": 60,
      "DEFAULT_MODEL": "gemini-2.5-flash",
      "MAX_OUTPUT_TOKENS": 1024,
      "TEMPERATURE": 0.5,
      "MAX_SOURCES": 5
    },
    "offline_mode": {
      "supported": true,
      "api_key_required": false,
      "notes": "Local embedding usage without Gemini API key"
    },
    "remote_mode": {
      "supported": true,
      "api_key_required": true,
      "api_key_env_vars": ["GEMINI_API_KEY", "GOOGLE_API_KEY"]
    }
  },

  "test_coverage": {
    "target_percentage": 90,
    "enforcement": "pytest --cov-fail-under=90",
    "test_suites": {
      "security": "tests/test_security.py",
      "edge_cases": "tests/test_edge_cases.py",
      "performance": "tests/test_performance.py",
      "core_functionality": "tests/test_*.py"
    }
  },

  "file_structure": {
    "critical_files": [
      "flamehaven_filesearch/api.py",
      "flamehaven_filesearch/config.py",
      "flamehaven_filesearch/core.py",
      "requirements.txt",
      "pyproject.toml",
      "LICENSE",
      ".env.example"
    ],
    "security_configurations": [
      ".github/workflows/security.yml",
      ".github/workflows/secrets.yml",
      ".pre-commit-config.yaml"
    ],
    "test_files": [
      "tests/test_security.py",
      "tests/test_edge_cases.py",
      "tests/test_performance.py"
    ]
  },

  "cicd_pipelines": {
    "security_scanning": {
      "workflow": ".github/workflows/security.yml",
      "triggers": ["push", "pull_request", "schedule"],
      "jobs": ["bandit", "safety", "trivy", "codeql"]
    },
    "secrets_scanning": {
      "workflow": ".github/workflows/secrets.yml",
      "triggers": ["push", "pull_request", "schedule"],
      "jobs": ["gitleaks", "trufflehog", "custom-patterns", "env-validation"]
    }
  },

  "sidrce_metrics": {
    "baseline_score": 0.87,
    "target_score": 0.88,
    "integrity": {
      "code_quality": 0.90,
      "dependency_health": 0.92,
      "legal_compliance": 1.0
    },
    "resonance": {
      "documentation_consistency": 0.88,
      "api_design": 0.85,
      "error_handling": 0.83
    },
    "stability": {
      "security_posture": 0.95,
      "dependency_stability": 0.90,
      "test_infrastructure": 0.85
    }
  },

  "drift_detection": {
    "check_frequency": "per_commit",
    "alert_threshold": "any_critical_change",
    "monitored_items": [
      "dependencies.core",
      "dependencies.api",
      "dependencies.security",
      "security_posture.vulnerabilities",
      "configuration.defaults",
      "test_coverage.target_percentage"
    ],
    "automated_checks": [
      "Dependency version changes",
      "Security vulnerability count changes",
      "Test coverage regression",
      "API endpoint modifications",
      "Configuration drift"
    ]
  },

  "compliance": {
    "license": "MIT",
    "copyright": "2025 FLAMEHAVEN",
    "security_standards": [
      "OWASP Top 10",
      "CWE-22 (Path Traversal Protection)",
      "CVE remediation"
    ],
    "documentation_standards": [
      "All public APIs documented",
      "Security configurations documented",
      "Deployment guides complete"
    ]
  },

  "known_issues": {
    "phase_2": [],
    "future_enhancements": [
      "Rate limiting implementation (Phase 3)",
      "Caching layer (Phase 4)",
      "Prometheus metrics (Phase 4)",
      "Structured logging (Phase 4)"
    ]
  },

  "validation_commands": {
    "security_scan": "bandit -r flamehaven_filesearch/",
    "dependency_check": "safety scan",
    "test_suite": "pytest -v -m 'not slow'",
    "coverage_check": "pytest --cov=flamehaven_filesearch --cov-fail-under=90",
    "lint_check": "flake8 flamehaven_filesearch/ tests/",
    "type_check": "mypy flamehaven_filesearch/"
  },

  "rollback_procedures": {
    "if_drift_detected": [
      "1. Compare current state with this baseline",
      "2. Identify changed files and configurations",
      "3. Review git log for changes since baseline_date",
      "4. Restore from git commit or revert specific changes",
      "5. Re-run validation_commands to verify restoration",
      "6. Update drift detection alerts"
    ]
  },

  "notes": [
    "This baseline was established after Phase 1 and Phase 2 completion",
    "All CRITICAL security vulnerabilities have been eliminated",
    "FastAPI and starlette upgraded to patch CVE-2024-47874 and CVE-2025-54121",
    "Path traversal protection implemented with comprehensive test coverage",
    "Offline mode fully functional with conditional API key validation",
    "Security scanning and CI/CD pipelines operational",
    "90% test coverage threshold enforced",
    "Ready for Phase 3: API Enhancement & Error Handling"
  ]
}
